# 跟踪流程

在比赛中需要多辆无人车编队前进,规划模块需要知道哪些车辆是属于编队的,否则会将其判断为障碍物进行避障,无法完成编队,所以需要车辆的检测和跟踪,告知规划模块编队中其他车辆的位置.

目前的做法是在对点云中的车辆做完检测的基础上,使用卡尔曼滤波器对车辆进行跟踪,估计被跟踪车辆的位置和速度信息.

我可以使用的传感器数据有,本车激光雷达点云信息,本车的GPS坐标,其他车辆的GPS坐标,GPS坐标是不稳定的,不到迫不得已不适用,本车的里程计信息,当需要车辆跟随时,规划程序会给我发一个ros消息,告诉我跟踪开始,并告诉我需要跟踪的车辆编号;

这里计算车辆的位置并不是使用检测到的车辆点云质心,因为随着视角的变化,会观测到车辆的不同位置,返回的点云也不是车辆的整体,有时候只能看到车辆尾部,有时候可以观测到车辆的侧面,直接计算点云质心作为车辆的位置是不准确的,目前的做法是计算车辆尾部中心的坐标,因为车辆尾部基本上每一帧都能观测到,确定车辆尾部中心坐标的做法是寻找点云最小包围框四条边的中点距离上一帧车尾中心最近的,第一帧使用包围框的下边沿中心初始化;

## 1.预处理,跟踪初始化

跟踪时第一帧的初始化很重要,我们希望第一帧就找到需要跟踪的车辆,作为后续帧跟踪的基础

首先将检测到的车辆保存在一个动态数组vector中

1.如果检测到了一个或多个车辆,根据规划模块告诉我的前车编号,获取前车的GPS数据,再根据它和本车GPS之间的位姿关系,把GPS坐标转移到车体坐标系下,然后在数组中找到距离前车坐标最近的车辆,如果这个距离小于预先设置的坐标,就认为这辆车是待跟踪车辆,把它的坐标由车体坐标系转换到全局坐标系(里程计),用这个坐标初始化卡尔曼滤波器的状态;

如果距离大于阈值,说明没有正确检测到待跟踪车辆,就用GPS信息初始化卡尔曼滤波器;

2.如果检测到的车辆数量为0,就直接使用GPS信息对卡尔曼滤波器初始化;

在初始化的同时记录当前帧的时间戳,用来计算前后两帧的时间差;

## 2.卡尔曼滤波器的预测

在后续帧,获取当前帧时间戳,与上一帧保存的时间戳相减获得时间差,填入卡尔曼滤波器的状态转移矩阵,首先使用卡尔曼滤波器的预测方程估计跟踪车辆在本帧的位置和速度;

## 3.寻找匹配,卡尔曼滤波器跟新

寻找匹配的目的是确定当前帧检测到的车辆中哪一个是上一帧跟踪的目标,因为是单目标跟踪,所以匹配策略比较简单:

首先将检测到的车辆保存在一个动态数组vector中

1.如果检测到了一个或多个车辆,计算它们和卡尔曼滤波器预测值的距离,找到距离最小值对应的车辆,如果距离小于给定阈值,就认为匹配成功,用它的坐标使用卡尔曼滤波器的更新方程进行状态的更新,使用一个变量表示观测失败的次数,如果最近距离大于阈值,认为当前帧没有检测到跟踪车辆,观测失败计数变量+1,如果失败次数小于给定的阈值,直接使用卡尔曼滤波器的预测值作为当前帧车辆的位置,不进行更新,认为在短时间内运动状态不会发生太大的变化;如果观测失败个数大于阈值,使用GPS信息作为观测进行卡尔曼滤波器的更新,对状态进行修正;

2.如果没有检测到车辆,处理策略和检测到车辆但是观测失败的策略相同;

# 跟踪的精度

